#!/bin/env python3
from os import environ
from sys import argv, path

env = environ.get

path.append(env("GAME")) # my_whatever/game_docker
from sql.sql_query import psql

class work_class:
    def __init__(self) -> None:
        self.cmd = psql().cmd
        self.req_resource = 'Rock'
        self.summom_cost = 10
    
    def start_work(self):
        try:
            updated_amount = self.cmd(f'''update items
                set amount = amount - {self.summom_cost}
                where name = '{self.req_resource}'
                returning amount;''')
            print('Your balance:', updated_amount[0]['amount'])

            worker = self.cmd('''insert into worker (name) 
                                values ('Human') 
                                returning id, name, grade, level, job;''')
            worker_info = self.cmd(f'''insert into worker_info (worker_id)
                              values ({worker[0]['id']})
                              returning *;''')
            [print(f"{i}: {worker[0][i]}") for i in worker[0]]
            print(worker_info)
        except (NameError, TypeError) as error:
            print(error)
 
 

    def check_stock(self):
        try:
            check_quantity = self.cmd('''select amount from items
                                 where name = 'Rock';''')
            for n in check_quantity:
                if check_quantity[n]['amount'] < self.summon_cost:
                    print('you dont have enough materials')
        
        except Exception:
            pass
        
        
if __name__ == "__main__":
    work_class().start_work()
    
